app:
  name: "candlepilot"
  lock_key: "lock:cron"
  lock_ttl_seconds: 55

redis:
  url_env: "REDIS_URL"

discord:
  webhook_url_env: "DISCORD_WEBHOOK_URL"
  username: "CandlePilot"
  avatar_url: ""

mexc:
  api_key_env: "MEXC_KEY"
  api_secret_env: "MEXC_SECRET"

market:
  exchange: "mexc"
  market_type: "perp"
  timeframes: ["15m", "1h"]

universe:
  enable: true
  quote: "USDT"
  require_colon_quote: true
  top_n: 200
  min_quote_volume_usdt: 3000000
  refresh_seconds: 3600
  whitelist: []
  blacklist: []
  shard:
    enable: true
    symbols_per_run: 60
    state_key: "universe_shard_index:mexc:perp"
    step: 60

strategy:
  name: "trend_pullback_v1"
  version: "v1.1.0"       # bump when you change logic/filters
  min_confidence: 0.72

  ema_fast: 20
  ema_trend: 200
  atr_period: 14

  # New: trend strength filter (EMA trend slope vs ATR)
  trend_slope_lookback: 10
  trend_slope_min_atr: 0.20   # slope must be >= 0.20 ATR (long) or <= -0.20 ATR (short)

  # New: ATR% chop/spike filter
  atr_pct_min: 0.002          # 0.2%
  atr_pct_max: 0.020          # 2.0%

  # New: pullback depth filter (in ATR)
  pullback_min_atr: 0.15
  pullback_max_atr: 1.50

  # New: candle momentum filter (close location in candle)
  momentum_min: 0.55          # long: close near high; short: close near low

  stop_atr_mult: 2.5
  tp1_r: 1.5
  tp2_r: 3.0

  # Trailing behavior
  trail_atr_mult: 2.5
  trail_activation: "after_tp1"   # "after_tp1" or "immediate"
  trail_require_trend_valid: true  # only update trail when close is on correct side of EMA_fast

  # New: move stop to breakeven after TP1
  breakeven_after_tp1: true
  breakeven_offset_r: 0.0          # 0.0 = true breakeven; -0.1 = allow small loss; +0.1 = lock profit

  candles_limit: 300

performance:
  enable: true
  closed_trades_keep: 20000

publishing:
  published_ttl_days: 7
  cooldown_candles: 3
